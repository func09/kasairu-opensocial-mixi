<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="kasairu" author_email="mitusur.haga@gmail.com">
    <Require feature="opensocial-0.8" />
    <Require feature="dynamic-height" />
    <Require feature="minimessage" />
  </ModulePrefs>
  
  <!--
  ==============================================================================
   Home View
  ==============================================================================
  -->
  <Content type="html" view="home"><![CDATA[
    <script type="text/javascript" src="http://opensocial-jquery.googlecode.com/svn/tags/1.0.1/features/opensocial-jquery/opensocial-jquery.min.js"></script>
    <p>Home View</p>
    <div>
      あなたが今日傘を持って出かける必要があるのか教える前に、あなたの住んでいる場所を設定しましょう。
    </div>
  ]]></Content>
  
  <!--
  ==============================================================================
   Profile View
  ==============================================================================
  -->
  <Content type="html" view="profile"><![CDATA[
    <script type="text/javascript" src="http://opensocial-jquery.googlecode.com/svn/tags/1.0.1/features/opensocial-jquery/opensocial-jquery.min.js"></script>
    <p>Profile View</p>
    <div>
      ○○さんはまだ地域設定をおこなっていません。
    </div>
  ]]></Content>
  
  <!--
  ==============================================================================
   Canvas View
  ==============================================================================
  -->
  <Content type="html" view="canvas"><![CDATA[
    <style type="text/css">
      
    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript">
      
      var flashMessage;
      var owner;
      var ownerAppData;
      
      /**
       * 初期化
       * アプリのオーナー情報、永続データの取得を行う
       */
      function init(){
        flashMessage = new gadgets.MiniMessage(null,'flash-message');
        var req = opensocial.newDataRequest();
        req.add(req.newFetchPersonRequest("OWNER"), "get_owner");
        req.add(req.newFetchPersonAppDataRequest(opensocial.newIdSpec({"userId":"OWNER"}),["cityId"]),"get_owner_appdata");
        req.send(handleCompleteInit);
        
        // VIEWの設定
        $('#btn-setting').click(function(){
          flashMessage.createTimerMessage("Change Setting",2);
        });
        
      }
      
      /**
       * 初期化後のコールバック処理
       */
      function handleCompleteInit(response){
        if (response.hadError()) {
          console.error(response.getErrorMessage());
          return;
        }
        owner = response.get("get_owner");
        ownerAppData = response.get("get_owner_appdata");
        
        // flashMessage.createTimerMessage("Hello World",2);
        
      }
      
      gadgets.util.registerOnLoadHandler(init);
      
	  </script>
	  
    <div id="flash-message"></div>
    
    <div id="setting" style="">
      <h3>あなたの地域を設定してください。</h3>
      <select>
        <option>aaaa</option>
      </select>
      <button id="btn-setting">設定変更</button>
    </div>
    
    <div>
      傘を持ってでかけましょう！（東京）
    </div>
  ]]></Content>
  
</Module>